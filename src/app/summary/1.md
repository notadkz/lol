# Tóm tắt: Cập nhật Tích hợp PayOS

## Vấn đề

- Gặp lỗi 500 Internal Server Error khi tạo thanh toán qua PayOS
- Lỗi "Thông tin truyền lên không đúng" từ API PayOS
- Cấu hình API URL không chính xác (sử dụng sandbox URL trong khi PayOS đã hợp nhất URL)

## Giải pháp

### 1. Cập nhật API URL

- Thay đổi từ `https://api-sandbox.payos.vn` sang `https://api-merchant.payos.vn`
- PayOS hiện sử dụng cùng một URL cho cả môi trường thật và môi trường test

### 2. Cập nhật định dạng dữ liệu

- Bổ sung trường `items` theo yêu cầu mới của PayOS
- Chuyển thông tin người dùng (buyer) thành thuộc tính tùy chọn
- Xử lý thông tin người dùng một cách linh hoạt hơn

### 3. Cải thiện xử lý lỗi

- Hiển thị thông báo lỗi chi tiết từ PayOS
- Sử dụng interface TypeScript để kiểm tra kiểu dữ liệu của OrderInfo

## Khuyến nghị cấu hình

Kiểm tra file `.env.local` hoặc `.env` để đảm bảo các thông tin sau được thiết lập:

```
PAYOS_CLIENT_ID=your_client_id_here
PAYOS_API_KEY=your_api_key_here
PAYOS_CHECKSUM_KEY=your_checksum_key_here
PAYOS_API_URL=https://api-merchant.payos.vn
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## Lưu ý

- Cần kiểm tra cấu hình API key và Client ID với tài khoản PayOS
- Nếu vẫn gặp lỗi, có thể liên hệ với bộ phận hỗ trợ của PayOS
